import{N as j,c as y,j as e,M as O,r as i,u as _,a as D,b as S,R as b,O as H,p as G,d as U,B as X,C as $,H as V,e as W,f as q,g as Y,h as z,s as J,i as K,k as Q,l as Z,m as ee,n as se,o as ae,E as re,P as te,W as ie,q as ne,t as ce}from"./index-64cfaed5.js";const oe=s=>s[j.Comments].comments,le=s=>s[j.Comments].commentsStatus,me=s=>s[j.Comments].PostCommentStatus,fe=y(le),de=s=>s[j.OffersNearby].offersNearby,_e=s=>s[j.OffersNearby].offersNearbyStatus,ue=y(_e);function he({date:s,userName:c,avatarUrl:t,isPro:n,comment:a,rating:l}){const f=new Date(s);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:t,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:c}),n&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${l*(100/O)}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:a}),e.jsx("time",{className:"reviews__time",dateTime:f.toISOString().slice(0,10),children:f.toLocaleDateString("en-US",{year:"numeric",month:"long"})})]})]})}function xe(){const s=i.memo(he),t=[..._(oe)].sort((a,l)=>Date.parse(l.date)-Date.parse(a.date)),n=t.slice(0,D);return e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:t.length})]}),e.jsx("ul",{className:"reviews__list",children:n.map(a=>e.jsx(s,{date:a.date,userName:a.user.name,avatarUrl:a.user.avatarUrl,isPro:a.user.isPro,comment:a.comment,rating:a.rating},a.id))})]})}function ve({id:s}){const[c,t]=i.useState({review:"",rating:""}),{review:n,rating:a}=c,l=i.useRef(null),f=_(me),x=S(),r=f===b.Loading,u=f===b.Succeeded,v=Number(a)>=1&&Number(a)<=5,h=n.length>=50&&n.length<=300,p=v&&h;i.useEffect(()=>{u&&l.current&&(t({review:"",rating:""}),l.current.reset())},[u]);const N=m=>{const{name:d,value:g}=m.target;t({...c,[d]:g})},w=()=>H.map(({title:m,rating:d})=>e.jsxs(i.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",id:`${d}-stars`,name:"rating",value:d,type:"radio",disabled:r,onChange:N}),e.jsx("label",{className:"reviews__rating-label form__rating-label",htmlFor:`${d}-stars`,title:m,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},d)),o=m=>{m.preventDefault(),p&&x(G({id:s,comment:n,rating:Number(a)}))};return e.jsxs("form",{ref:l,className:"reviews__form form",action:"#",method:"post",onSubmit:o,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:w()}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"review",value:n,placeholder:"Tell how was your stay, what you like and what can be improved",disabled:r,onChange:N}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set  ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least  ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!p||r,children:r?"Submitting…":"Submit"})]})]})}function pe({images:s}){const c=s.slice(0,U);return e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:c.map(t=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:t,alt:"Photo studio"})},t))})})}function je({id:s,title:c,type:t,isPremium:n,rating:a,price:l,bedrooms:f,goods:x,maxAdults:r}){const u=Math.round(a),v=i.memo(X);return e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:c}),e.jsx(v,{id:s,buttonClassName:$.FullOfferButtonType})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:`${u*(100/O)}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:a})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:t.charAt(0).toUpperCase()+t.slice(1)}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[f," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",l]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:x.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]})]})}function Ne({host:s,description:c}){const{isPro:t,avatarUrl:n,name:a}=s;return e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:"offer__avatar-wrapper offer__avatar-wrapper--pro user__avatar-wrapper",children:e.jsx("img",{className:"offer__avatar user__avatar",src:n,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:a}),t&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:c})})]})}function we(){const s=i.memo(V),c=i.memo(xe),t=i.memo(ve),n=i.memo(W),a=i.memo(pe),l=i.memo(je),f=i.memo(Ne),x=i.memo(q),r=_(Y),u=_(de),v=_(z),h=!_(fe).isFailed,p=!_(ue).isFailed,{isLoading:N,isFailed:w}=_(J),{id:o}=K(),m=S();i.useEffect(()=>{o&&(m(Q(o)),m(Z(o)),m(ee(o)),m(se(o)))},[m,o]);const d=r===null?[]:[{id:r.id,title:r.title,price:r.price,type:r.type,isFavorite:r.isFavorite,isPremium:r.isPremium,city:r.city,location:r.location,rating:r.rating,previewImage:""}],g=u.slice(0,ae),C=[...d,...g];if(w)return e.jsx(re,{});if(N||!r)return e.jsx(te,{});const{title:R,type:M,isPremium:F,rating:P,description:A,price:E,bedrooms:L,goods:I,host:T,images:B,maxAdults:k}=r;return e.jsxs("div",{className:"page","data-testid":"offer-page",children:[e.jsx(ie,{children:e.jsx("title",{children:ne.OfferPage})}),e.jsx(s,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx(a,{images:B}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[o&&e.jsx(l,{id:o,title:R,type:M,isPremium:F,rating:P,price:E,bedrooms:L,goods:I,maxAdults:k}),e.jsx(f,{host:T,description:A}),e.jsxs("section",{className:"offer__reviews reviews",children:[h&&e.jsx(c,{}),v&&o&&e.jsx(t,{id:o})]})]})}),e.jsx("section",{className:"offer__map map",children:p&&e.jsx(n,{startPoint:r.city,points:C})})]}),p&&e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(x,{offers:g,cardClassName:ce.OfferPageCardType})]})})]})]})}export{we as default};
